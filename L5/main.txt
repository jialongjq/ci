/* Main.c file generated by New Project wizard
 *
 * Created:   do. oct. 18 2020
 * Processor: PIC18F45K22
 * Compiler:  MPLAB XC8
 */

#include <xc.h>

void initializate_variables() {
   TRISD = 0; // Set port D as output
   TRISA = 0; // Set port A as output
   TRISC = 1; // Set port C as input
   ANSELD = 0; // Set port D as digital
   ANSELA = 0; // Set port A as digital
   ANSELC = 0; // Set port C as digital
   PORTC = 0x00; // Initialize port C as 0x00
   PORTA = 0x00; // Initialize port A as 0x00
   PORTD = 0x00; // Initialize port D as 0x00
}

void print_n(int n) {
   if (n == 0) PORTD = 0x3F;
   else if (n == 1)  PORTD = 0x06;
   else if (n == 2) PORTD = 0x5B;
   else if (n == 3) PORTD = 0x4F;
   else if (n == 4)  PORTD = 0x66;
   else if (n == 5) PORTD = 0x6D;
   else if (n == 6) PORTD = 0x7D;
   else if (n == 7)  PORTD = 0x07;
   else if (n == 8) PORTD = 0x7F;
   else if (n == 9) PORTD = 0x6F;
}

void main(void) {
    initializate_variables();
   
    char programa = '1'; // Inicialitzat amb el programa 1
    PORTAbits.RA1 = 1;
    char signal = 'L';
    int i = 30000;
    int n = 0;
    int big_n = 9456, decimal = 2;
    while (1) {
      // Flanc de pujada
      if (PORTCbits.RC1 == 1 && signal == 'L') {
	 signal = 'H';
	 if (programa == '1') {
	    i = 0;
	    PORTD = 0x00;
	    programa = '2';
	 }
	 else {
	    i = 30000;
	    PORTA = 0x02;
	    PORTD = 0x00;
	    n = 0;
	    programa = '1';
	 }
      }
      else if (PORTCbits.RC1 == 0 && signal == 'H') {
	 signal = 'L';
      }
      
      if (programa == '1') {
	 if (i == 30000) {
	    print_n(n);
	    n += 1;
	    if (n == 10) n = 0;
	    i = 0;
	 }
	 else ++i;
      }
      else if (programa == '2') {
	 if (i == 0) {
	    PORTD = 0x00;
	    PORTA = 0x01;
	    print_n(big_n % 10);
	 }
	 else if (i == 1) {
	    PORTD = 0x00;
	    PORTA = 0x02;
	    print_n((big_n % 100) / 10);
	    if (decimal == 1) PORTD += 0x80;
	 }
	 else if (i == 2) {
	    PORTD = 0x00;
	    PORTA = 0x04;
	    print_n((big_n % 1000) / 100);
	    if (decimal == 2) PORTD += 0x80;
	    
	 }
	 else if (i == 3) {
	    PORTD = 0x00;
	    PORTA = 0x08;
	    print_n(big_n / 1000);
	    if (decimal == 3) PORTD += 0x80;
	    
	 }
	 ++i;
	 if (i == 4) i = 0;
      }
   }
}
 
 