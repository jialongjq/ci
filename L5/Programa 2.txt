/* Main.c file generated by New Project wizard
 *
 * Created:   do. oct. 18 2020
 * Processor: PIC18F45K22
 * Compiler:  MPLAB XC8
 */

#include <xc.h>

void initializate_variables() {
   TRISD = 0; // Set port D as output
   TRISA = 0; // Set port A as output
   TRISC = 1; // Set port C as input
   ANSELD = 0; // Set port D as digital
   ANSELA = 0; // Set port A as digital
   ANSELC = 0; // Set port C as digital
   PORTC = 0x00; // Initialize port C as 0x00
   PORTA = 0x00; // Initialize port A as 0x00
   PORTD = 0x00; // Initialize port D as 0x00
}

void print_n(int n) {
   if (n == 0) PORTD = 0x3F;
   else if (n == 1)  PORTD = 0x06;
   else if (n == 2) PORTD = 0x5B;
   else if (n == 3) PORTD = 0x4F;
   else if (n == 4)  PORTD = 0x66;
   else if (n == 5) PORTD = 0x6D;
   else if (n == 6) PORTD = 0x7D;
   else if (n == 7)  PORTD = 0x07;
   else if (n == 8) PORTD = 0x7F;
   else if (n == 9) PORTD = 0x6F;
}

void programa_2(int n, int d, int* i) {
   if (*i == 0) {
      PORTD = 0x00;
      PORTA = 0x01;
      print_n(n % 10);

   }
   else if (*i == 1) {
      PORTD = 0x00;
      PORTA = 0x02;
      print_n((n % 100) / 10);
      if (d == 1) PORTD += 0x80;

   }
   else if (*i == 2) {
      PORTD = 0x00;
      PORTA = 0x04;
      print_n((n % 1000) / 100);
      if (d == 2) PORTD += 0x80;

   }
   else if (*i == 3) {
      PORTD = 0x00;
      PORTA = 0x08;
      print_n(n / 1000);
      if (d == 3) PORTD += 0x80; 

   }
   ++(*i);
   if (*i == 4) *i = 0;
}

void main(void) {
   initializate_variables();
   
   char programa = '1'; // Inicialitzat amb el programa 1
   int i = 0;
   int* i_ptr = &i;
   
   while (1) {
      programa_2(1234, 2, i_ptr);
   }
}
 